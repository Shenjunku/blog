---
title: 微信小程序
date: 2025-8-02
sidebar: 'auto'
categories:
 - 小程序
tags:
 - 小程序
---
## 微信小程序是什么？

微信小程序是腾讯微信团队推出的一种**轻量级应用形态**，无需下载安装，用户可在微信内直接打开使用，兼具 “用完即走” 的便捷性和接近原生应用的体验。
### 微信小程序的优点

1. **使用便捷，降低用户门槛**
   - 无需下载安装，通过微信扫码、搜索或分享链接即可打开，减少用户 “下载 - 安装 - 注册” 的流程，降低使用阻力。
   - 占用手机存储空间极小，适合低频使用但必要的场景（如扫码点餐、公交查询）。
2. **依托微信生态，流量红利显著**
   - 直接触达微信 10 亿 + 月活用户，可通过微信群、朋友圈、公众号等社交渠道快速传播，获客成本低。
   - 无缝对接微信支付、小程序码、地理位置等功能，简化交易流程（如线下扫码支付、同城服务）。
3. **开发成本低，迭代高效**
   - 采用类 HTML/CSS/JavaScript 的技术栈（WXML/WXSS/JS），前端开发者易上手，无需学习新语言。
   - 发布流程简单，审核速度快（通常 1-3 天），支持快速迭代优化，适合小团队试错。
4. **体验接近原生应用**
   - 加载速度优于 H5 页面，支持离线缓存、本地存储，交互流畅度接近原生 APP。
   - 提供丰富的原生组件（如地图、相机、扫码）和 API，可实现复杂功能（如实时聊天、视频播放）。

### 微信小程序的缺点

1. **功能和性能存在限制**
   - 包体大小受限（主包默认≤2MB，分包后总大小≤20MB），无法承载过于复杂的功能（如大型游戏、视频编辑）。
   - 后台运行能力弱，切换到微信后台后易被回收，不适合需要长期后台运行的场景（如音乐播放、实时定位跟踪）。
2. **对微信生态依赖性强**
   - 完全依赖微信平台，受微信政策限制（如流量分配、接口权限调整），若违反规则可能被下架。
   - 无法脱离微信独立存在，用户留存依赖微信生态内的触达（如 “我的小程序” 入口）。
3. **用户留存和品牌认知较弱**
   - “用完即走” 的特性导致用户主动打开率低，缺乏类似 APP 的桌面图标入口，需通过强提醒（如服务通知）召回用户。
   - 品牌露出有限，用户对小程序的认知多依附于微信，难以建立独立品牌形象。
4. **兼容性和性能瓶颈**
   - 在低配置手机或旧版微信中可能出现卡顿、样式错乱，需要额外做兼容性处理。
   - 复杂动画、大量数据渲染时性能不如原生 APP，体验差距明显。

### 总结

微信小程序的核心价值在于 **“轻量、便捷、低成本”**，适合高频刚需、工具类、线下服务等场景；但受限于包体大小和平台规则，难以替代功能复杂的原生 APP。其成功与否高度依赖微信生态的流量赋能和场景匹配度。

## 微信小程序的生命周期分为**应用生命周期**和**页面生命周期**，具体函数如下：

### 一、应用生命周期（在 `app.js` 中定义）

- `onLaunch`：小程序初始化完成时触发（全局只触发一次）。
- `onShow`：小程序启动或从后台切换到前台时触发。
- `onHide`：小程序从前台切换到后台时触发。
- `onError`：小程序发生脚本错误或 API 调用失败时触发。

### 二、页面生命周期（在页面的 `.js` 文件中定义）

- `onLoad`：页面加载时触发（可获取页面参数 `options`），只触发一次。
- `onShow`：页面显示 / 切入前台时触发。
- `onReady`：页面初次渲染完成时触发（可操作界面元素），只触发一次。
- `onHide`：页面隐藏 / 切入后台时触发（如跳转到其他页面）。
- `onUnload`：页面卸载时触发（如返回上一页）。

## 微信小程序中路由跳转方式

### 1. `wx.navigateTo`

- **特点**：保留当前页面，跳转到新页面（入栈操作），新页面左上角有返回按钮。
- **限制**：页面栈最多 10 层，超过会跳转失败。
- **适用场景**：普通页面跳转（如列表页→详情页），需返回原页面的场景。

### 2. `wx.redirectTo`

- **特点**：关闭当前页面，跳转到新页面（替换栈顶页面），新页面左上角无返回按钮（或显示首页按钮）。
- **适用场景**：不需要返回原页面的跳转（如登录页→首页）。

### 3. `wx.reLaunch`

- **特点**：关闭所有页面，打开新页面（清空页面栈）。
- **适用场景**：退出登录后跳转首页、小程序入口页切换等需重置页面栈的场景。

### 4. `wx.switchTab`

- **特点**：只能跳转到配置在 `app.json` 中 `tabBar` 的页面，同时关闭其他非 `tabBar` 页面。
- **适用场景**：底部导航栏之间的切换（如首页→我的）。

### 5. `wx.navigateBack`

- **特点**：关闭当前页面，返回上一页面或多级页面（出栈操作），通过 `delta` 参数指定返回层数（默认 1 层）。
- **适用场景**：从详情页返回列表页等需要回退的场景。

### 核心区别总结

| 方式              | 页面栈操作           | 是否可返回原页面 | 跳转限制                 |
| ----------------- | -------------------- | ---------------- | ------------------------ |
| `wx.navigateTo`   | 入栈（新增页面）     | 是               | 最多 10 层               |
| `wx.redirectTo`   | 替换栈顶（关闭当前） | 否               | 不能跳转到 `tabBar` 页面 |
| `wx.reLaunch`     | 清空栈（关闭所有）   | 否               | 无页面类型限制           |
| `wx.switchTab`    | 切换 `tabBar` 页面   | 否（保留 `tab`） | 只能跳转到 `tabBar` 页面 |
| `wx.navigateBack` | 出栈（关闭当前）     | -                | 只能返回已打开的页面     |

## 微信小程序的登录流程 
1. **用户授权**：用户进入小程序后，小程序会请求用户进行授权，授权内容通常包括昵称、头像等基本信息，用户需点击 “允许” 或 “确认” 按钮进行授权。
2. **获取临时登录凭证（code）**：用户授权后，小程序会调用微信提供的`wx.login`接口，获取一个临时登录凭证`code`，该`code`是一次性的，且具有时效性，通常有效期为 5 分钟。
3. **发送 code 到开发者服务器**：小程序前端将获取到的`code`通过 HTTP 请求发送到开发者服务器。
4. **服务器请求 session_key 和 openid**：开发者服务器使用获取到的`code`、小程序的`appid`和`appsecret`向微信服务器发送请求，通过调用微信提供的`auth.code2Session`接口，换取用户的`session_key`和`openid`。其中，`openid`是用户在当前小程序的唯一标识，`session_key`是微信服务器返回的会话密钥，用于解密用户的敏感数据。
5. **生成自定义登录态**：开发者服务器根据获取到的`session_key`和`openid`，可以生成自定义的登录态，如 JWT token，这个登录态将用于后续请求的身份验证。
6. **返回登录态给前端**：开发者服务器将生成的自定义登录态返回给小程序前端。
7. **前端保存登录态**：小程序前端接收到登录态后，将其保存在本地存储，如使用`wx.setStorageSync`方法，以便后续请求时进行身份验证。

### 微信小程序的发布流程

- 在微信开发者工具中将代码上传到微信公众平台，生成体验版；
- 测试人员扫描体验版二维码进行测试工作；
- 测试通过后，点击提交审核，进入审核流程，通常24小时就能出结果；
- 审核通过后，用户即可通过微信搜索到我们的小程序；